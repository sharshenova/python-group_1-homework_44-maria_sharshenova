{% extends 'base.html' %}
{% block title %}Заказ{% endblock %}
{% load staticfiles %}
{% block content %}
    <h2>Заказ {{ order.id }}</h2>
    <p>Имя клиента: {{ order.contact_name }}</p>
    <p>Телефон: {{ order.contact_phone }}</p>
    <p>Адрес доставки: {{ order.delivery_address }}</p>
    <p>Статус доставки: {{ order.get_status_display }}</p>
    <p>Оператор: {{ order.operator }}</p>
    <p>Курьер: {{ order.courier }}</p>
    {% if perms.webapp.change_order and order.can_be_changed %}
        <a href="{% url "webapp:order_update" order.pk %}">Изменить детали</a><br>
    {% endif %}
    {% if perms.webapp.change_order and order.can_be_canceled %}
        <a href="{% url "webapp:order_cancel" order.pk %}">Отменить заказ</a>
    {% endif %}
    {% if perms.webapp.change_order and order.is_canceled %}
        <a href="{% url "webapp:order_update" order.pk %}">Восстановить заказ</a>
    {% endif %}
    <hr>
    <ul id="order_food_list">
        {% for orderFood in order.foods.all %}
            <li id="orderFood_{{ orderFood.pk }}" class="d-inline-block"><span class="food_name" data-food_pk="{{ orderFood.food.pk }}">{{ orderFood.food.name }}</span>: <span class="food_amount">{{ orderFood.amount }}</span></li>
            {% if perms.webapp.change_orderfoods and order.can_be_changed %}
                <a href="{% url 'webapp:order_food_update' orderFood.pk %}" data-pk="{{ orderFood.pk }}" class="update_link"><i class="fa fa-edit"></i></a><br>
{#                <a href="#" data-form_action="{% url 'webapp:order_food_delete' orderFood.pk %}"><i class="fa fa-trash"></i></a><br>#}
            {% endif %}
        {% endfor %}
    </ul>

    {% if perms.webapp.add_orderfoods and order.can_be_changed %}
        <a href="{% url 'webapp:order_food_create' order.pk %}" class="add_link" data-toggle="modal" data-target="#food_edit_modal"
>Добавить блюдо</a><br>
    {% endif %}
    <hr>


    <div class="modal" tabindex="-1" role="dialog" id="food_edit_modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Добавить блюда</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              <form id="food_form" method="POST">
                  {% csrf_token %}
                  {{ form.as_p }}
              </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="food_submit">Добавить</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
          </div>
        </div>
      </div>
    </div>


{% endblock %}

{% block scripts %}
    <script type="application/javascript" src="{% static 'js/main.js' %}"></script>
{% endblock %}

